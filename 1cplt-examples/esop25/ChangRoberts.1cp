role* @node(x: number = 0, leader: boolean = false, neigh: @node) {
  main:
    self.rank -> neigh.x |> forward

  forward:
    if
      self.rank < x
    then
      x -> neigh.x |> forward
    else {
      leader := self.rank == x ;
      if leader then
        \echo "Leader!"
    }
}

process @node[1](neigh = @node[2])
process @node[2](neigh = @node[3])
process @node[3](neigh = @node[1])

#analyze
#compile
#execute
